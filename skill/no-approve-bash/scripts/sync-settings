#!/bin/bash
# 同步 settings 权限到项目
# 用法: sync-settings [项目路径]

PROJECT_PATH="${1:-.}"
SETTINGS_FILE="$PROJECT_PATH/.claude/settings.local.json"

if [ ! -f "$SETTINGS_FILE" ]; then
    echo "❌ 未找到: $SETTINGS_FILE"
    exit 1
fi

echo "🔄 检查 settings 权限..."
echo "   项目: $PROJECT_PATH"
echo ""

# 检查是否已包含关键权限
if grep -q "Bash(~/.claude-bin/\*)" "$SETTINGS_FILE" 2>/dev/null; then
    echo "✅ 已包含 ~/.claude-bin/* 权限"
else
    echo "⚠️  缺少 ~/.claude-bin/* 权限"
    echo ""
    echo "请手动添加以下权限到 $SETTINGS_FILE："
    echo '    "Bash(~/.claude-bin/*)",'
fi

if grep -q "Bash(bash:\*)" "$SETTINGS_FILE" 2>/dev/null; then
    echo "✅ 已包含 bash:* 权限"
else
    echo "⚠️  缺少 bash:* 权限"
    echo ""
    echo "请手动添加以下权限到 $SETTINGS_FILE："
    echo '    "Bash(bash:*)",'
fi
